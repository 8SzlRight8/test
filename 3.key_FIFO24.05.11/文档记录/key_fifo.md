# 按键FIFO

2024.05.11  阵雨  11:10      大洋A4

---



## 前言

之前自己用的按键检测都是散装检测，输入设备都是各搞各的，需要更改设备时，就需要重新调用；且按键检测是用阻塞的方式进行检测，占用CPU资源，轮询时也容易卡死。故 趁目前工作不算太多，进行整理。



## 目前更新情况

| 功能需求                                                     | 完成情况                                                     |
| :----------------------------------------------------------- | :----------------------------------------------------------- |
| V1.0.0 <br />1、非阻塞检测按键<br />2、FIFO检测保存键值<br />3、实现 单击，双击，长按，连按，组合键<br />4、可方便的添加输入设备 | V1.0.0 <br />1、✅<br />2、✅<br />3、双击还未实现（决定不要添加）<br />4、还未实现，可以拿编码器试一下 |
|                                                              |                                                              |
|                                                              |                                                              |





## 一、需求分析

功能所需：

​    1、使用非阻塞的方式检测按键，避免占用过多的CPU资源。

​    2、使用FIFO进行 “键值” 的保存（定时器10ms一个周期），以及按键的读取。

​    3、方便添加其它的输入设备。比如按键、编码器、红外遥控等。

​    4、可以实现 “单击” 、 ~~“双击”~~ 、 “长按” 、 “连按” 、 “组合键” 。【后决定不要“双击”】

​        1）后续可以思考下怎么实现 双击（两次之间间隔500ms），短按 的区分以及实现。



## 二、整理流程

见流程图





## 三、问题汇总

1、调试方面

​        本来准备使用keil直接debug，进行调试，结果发现不太好使，每次到调用此函数时，却进不去函数，研究一会发现，根本没进入函数，但不知为何会走到这一步。而换了个断点位置则正常运行。故又新开一个串口打印来进行辅助调试，将按键按下的状态通过串口打印，然后就大功告成！





